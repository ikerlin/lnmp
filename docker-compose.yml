version: '2'
services:
  nginx:
      restart: always # 设置自启动
      image: hyt7212/nginx:1.10.3-alpine
      ports: # 宿主端口（映射到）-》docker镜像端口
        - "80:80" 
        - "443:443"
      volumes: # 配置文件宿主文件（映射到）-》docker镜像文件
        - ./nginx/nginx.conf:/etc/nginx/nginx.conf #nginx配置
        - ./nginx/fastcgi_params:/etc/nginx/fastcgi_params #fastcgi配置
        - ./nginx/sites-enabled:/etc/nginx/sites-enabled #站点配置
        - ./nginx/certs:/etc/nginx/certs #ssl证书
        - ./nginx/logrotate.d:/etc/logrotate.d/ # 日志分割配置
        - ../log/nginx:/data/log #nginx log目录
        - ../www/default:/data/www/default #站点根目录
        # - ../www/crm/code:/data/www/crm #CRM站点根目录
      links:
        - "php70"
      # external_links:
      container_name: nginx # docker镜像名称
  # php56:
  #     restart: always #设置自启动
  #     image: hyt7212/php:5.6-fpm
  #     volumes:
  #       - ../www:/data/www #站点根目录
  #       - ./php56/php.ini:/usr/local/etc/php/php.ini #配置文件
  #       - ./php56/php-fpm.conf:/usr/local/etc/php-fpm.conf #配置文件
  #       - ../log/php56:/opt/log/php #php log目录
  #     container_name: php56
  php70:
      restart: always #设置自启动
      image: hyt7212/php:7.0-fpm-dev
      volumes:
        - ./php70/base.ini:/usr/local/etc/php/conf.d/base.ini
        - ./php70/dev.ini:/usr/local/etc/php/conf.d/dev.ini
        - ../www/default:/data/www/default #站点根目录
      container_name: php70
  mysql:
      restart: always #设置自启动
      image: mysql:5.7
      ports:
        - "3306:3306"
      volumes:
        - ../mysqlData:/var/lib/mysql #数据目录
        - ./mysql/my.cnf:/etc/mysql/my.cnf  #配置文件
      environment:
        MYSQL_ROOT_PASSWORD: 123456
      container_name: mysql
  redis:
      restart: always #设置自启动
      image: redis:3.2.8-alpine #本地镜像
      volumes:
        - ../redis:/data #redis持久存储目录
        - ./redis/redis.conf:/usr/local/etc/redis/redis.conf #配置文件
      ports:
        - "6379:6379"
      command: redis-server /usr/local/etc/redis/redis.conf #redis持久存储
      container_name: redis